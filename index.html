

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Rock Gods Final Battle</title>
  <style>
    body {
      background: linear-gradient(135deg, #0f0c29, #302b63, #24243e);
      color: #fff;
      font-family: 'Orbitron', sans-serif;
      text-align: center;
      padding: 40px;
    }
    .button-container button {
      background: #ff0080;
      border: none;
      padding: 15px 30px;
      margin: 10px;
      font-size: 18px;
      color: #fff;
      cursor: pointer;
      border-radius: 5px;
    }
    .button-container button:hover {
      background: #ff66b2;
    }
    .note-sequence {
      font-size: 28px;
      margin: 20px;
    }
    #timer {
      font-size: 24px;
      margin: 20px;
      color: #ffcc00;
    }
  </style>
</head>
<body>
  <h1>Rock Gods Final Battle</h1>
  <div id="status">Select the number of players:</div>
  <div class="button-container" id="playerButtons"></div>
  <div class="button-container" id="noteButtons"></div>
  <div class="note-sequence" id="noteSequence"></div>
  <div id="timer"></div>
  <div class="button-container" id="passFailButtons"></div>

  <audio id="backgroundMusic" loop>
    <source src="background.mp3" type="audio/mpeg" />
  </audio>

  <script>
    const statusDiv = document.getElementById('status');
    const playerButtonsDiv = document.getElementById('playerButtons');
    const noteButtonsDiv = document.getElementById('noteButtons');
    const noteSequenceDiv = document.getElementById('noteSequence');
    const passFailButtonsDiv = document.getElementById('passFailButtons');
    const timerDiv = document.getElementById('timer');

    const notes = ["C", "C#", "D", "D#", "E", "F", "F#", "G", "G#", "A", "A#", "B"];
    const roundChoices = [
      [4,5,6],
      [5,6,7],
      [6,7,8]
    ];
    let numPlayers = 0;
    let currentPlayer = 1;
    let currentRound = 1;
    const totalRounds = 3;
    const playerProgress = {};

    // Start background music
    const bgMusic = document.getElementById('backgroundMusic');
    bgMusic.volume = 0.3;
    bgMusic.play();

    // Initialize
    statusDiv.textContent = "Select the number of players:";
    [2,3,4].forEach(n => {
      const button = document.createElement('button');
      button.textContent = `${n} Players`;
      button.onclick = () => startGame(n);
      playerButtonsDiv.appendChild(button);
    });

    function startGame(n) {
      numPlayers = n;
      for (let i=1;i<=n;i++) {
        playerProgress[i] = 0;
      }
      currentPlayer = 1;
      currentRound = 1;
      startRound();
    }

    function startRound() {
      if (currentRound > totalRounds) {
        endGame();
        return;
      }
      statusDiv.textContent = `Player ${currentPlayer}, Round ${currentRound}: Choose sequence length.`;
      noteButtonsDiv.innerHTML = '';
      noteSequenceDiv.textContent = '';
      passFailButtonsDiv.innerHTML = '';
      timerDiv.textContent = '';

      const choices = roundChoices[currentRound -1];
      choices.forEach(length => {
        const button = document.createElement('button');
        button.textContent = `${length} Notes`;
        button.onclick = () => {
          generateSequence(length);
          startTimer();
        };
        noteButtonsDiv.appendChild(button);
      });
    }

    function generateSequence(length) {
      let seq = [];
      while(seq.length < length){
        const n = notes[Math.floor(Math.random()*notes.length)];
        seq.push(n);
      }
      noteSequenceDiv.textContent = seq.join(" - ");
      noteButtonsDiv.innerHTML = '';
      showPassFail();
    }

    function startTimer() {
      let timeLeft = 10;
      timerDiv.textContent = `Time left: ${timeLeft}`;
      const timerInterval = setInterval(() => {
        timeLeft--;
        if (timeLeft <=0){
          clearInterval(timerInterval);
          timerDiv.textContent = "Time's up!";
          playSound('time_up.mp3');
        } else {
          timerDiv.textContent = `Time left: ${timeLeft}`;
        }
      },1000);
    }

    function showPassFail() {
      passFailButtonsDiv.innerHTML = '';
      const pass = document.createElement('button');
      pass.textContent = "Pass";
      pass.onclick = () => {
        playerProgress[currentPlayer]++;
        advanceTurn();
      };
      const fail = document.createElement('button');
      fail.textContent = "Fail";
      fail.onclick = () => {
        advanceTurn(true);
      };
      passFailButtonsDiv.appendChild(pass);
      passFailButtonsDiv.appendChild(fail);
    }

    function advanceTurn(failed=false){
      if (failed){
        playerProgress[currentPlayer] = -1; // mark as out
      }
      // Check if all failed
      const active = Object.values(playerProgress).filter(p => p >=0);
      if (active.length==0){
        endGame(false);
        return;
      }
      // Move to next player
      do {
        currentPlayer++;
        if (currentPlayer>numPlayers){
          currentPlayer=1;
          currentRound++;
        }
      } while(playerProgress[currentPlayer]<0);

      if (currentRound>totalRounds){
        endGame(true);
      } else {
        startRound();
      }
    }

    function endGame(success=true){
      noteButtonsDiv.innerHTML = '';
      passFailButtonsDiv.innerHTML = '';
      noteSequenceDiv.textContent = '';
      timerDiv.textContent = '';
      if (success){
        statusDiv.textContent = "YOU HAVE DEFEATED THE ROCK GODS! You are true Rock Legends!";
        playSound('success.mp3');
      } else {
        statusDiv.textContent = "The Rock Gods have crushed your spirit. Rock regresses to safe mediocrity...";
        playSound('fail.mp3');
      }
    }

    function playSound(src){
      const audio = new Audio(src);
      audio.play();
    }
  </script>
</body>
</html>
